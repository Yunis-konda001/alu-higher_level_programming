#!/bin/bash

if [ -z "$PYFILE" ]; then
    echo "Error: PYFILE environment variable is not set."
    exit 1
fi

if [ ! -f "$PYFILE" ]; then
    echo "Error: Python file '$PYFILE' not found."
    exit 1
fi

pyc_file="${PYFILE}c"
python3 -m compileall "$PYFILE" > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "Error: Compilation failed for $PYFILE"
    exit 1
fi

mv "${PYFILE}__pycache__/${PYFILE%.py}.cpython-*.pyc" "$pyc_file"
rm -rf "${PYFILE}__pycache__"

echo "Compilation successful. Compiled file: $pyc_file"
